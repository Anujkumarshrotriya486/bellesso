var GmCXt,stepAudio={},userPrefAudio=!1;function modifyElements(e,t,a){e.forEach(e=>{switch(t){case"show":e.style.display="block";break;case"hide":e.style.display="none";break;case"addClass":e.classList.add(a);break;case"removeClass":e.classList.remove(a)}})}function setAudioModeOn(){modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-on"),"show"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-off"),"hide"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio"),"addClass","playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSTest2_action:set_audio_storage",{stepAudioRunningStatus:!0})}function setAudioModeOff(){modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-on"),"hide"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-off"),"show"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio"),"removeClass","playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSTest2_action:set_audio_storage",{stepAudioRunningStatus:!1})}function parseJSON(e){try{return"object"==typeof e?e:""===e||"AS"===e||"na"===e||"[object Object]"===e||void 0===e||"undefined"===e?{}:JSON.parse(e)}catch(e){return{}}}function parseMsg(e){var t={};return t.data=parseJSON(e.data),t.data}function getCdnSign(){var e="";return e=GmCXt.user?GmCXt.user.cdn_signature:e}function pauseAudio(){GmCXt.audioObject&&GmCXt.audioObject.pause()}function formatAndSendToParentWindow(e,t){var a={};a.action=e,a.mgdata=t||{},!GmCXt.playerI&&null!==GmCXt.playerI||(a.mgdata.playerInstance=GmCXt.playerI),GmCXt.msgChannel.port1.postMessage(JSON.stringify(a))}function getStepFromPlayerI(e){for(var t=!1,a=GmCXt.playerI.tour.steps,o=0;o<a.length;o++)if(parseInt(a[o].step_id)===parseInt(e)){t=a[o];break}return t.step_description||(t.step_description=" "),t.image_url=t.image_url+getCdnSign(),t.screen_url=t.screen_url+getCdnSign(),t}(GmCXt=void 0===GmCXt?{}:GmCXt).msgChannel=new MessageChannel,GmCXt.startMsgChannel=function(e){window.top.postMessage(e,"*",[GmCXt.msgChannel.port2])},0<document.querySelectorAll(".mgPlayerJSTest2_audio-iframe-icons").length&&GmCXt.startMsgChannel("Guide:audioIframe"),void 0===GmCXt.requestHandler&&(GmCXt.requestHandler={}),GmCXt.requestHandler.playAudioTrack=function(e){e.data.playerInstance&&(GmCXt.playerI=e.data.playerInstance),GmCXt.playStepAudio(e.data)},GmCXt.requestHandler.stopAudioTrack=function(e){GmCXt.stopAudio()},window.addEventListener("message",function(e){GmCXt=GmCXt||e.target.GmCXt;var t=parseMsg(e);if(t&&t.action&&0===t.action.indexOf("mgPlayerJSTest2_action:"))switch(t.mgdata&&t.mgdata.playerInstance&&(GmCXt.playerI=t.mgdata.playerInstance),t.action){case"mgPlayerJSTest2_action:set_audio_mode_on":setAudioModeOn();break;case"mgPlayerJSTest2_action:set_audio_mode_off":setAudioModeOff();break;case"mgPlayerJSTest2_action:stop_audio":GmCXt.requestHandler.stopAudioTrack();break;case"mgPlayerJSTest2_action:set_style_audio_icon_response":document.documentElement.insertAdjacentHTML("beforeend",t.mgdata.data),document.querySelectorAll(".mgPlayerJSTest2_audio-iframe-icons").forEach(e=>{e.removeAttribute("style")}),t.mgdata.user&&(GmCXt.user=t.mgdata.user),formatAndSendToParentWindow("mgPlayerJSTest2_action:hide_pop_audio_ctrl",{})}},!1),GmCXt.checkAssetUrl=function(e,t,a){e===t?a(e):GmCXt.checkFileExist(e).then(function(){a(e)}).catch(function(e){a(t)})},GmCXt.playStepAudio=function(o){GmCXt.isPageReloaded=!1,setAudioModeOn(),o&&o.data||GmCXt.playerI&&(e=getStepFromPlayerI(GmCXt.playerI.currentStepId),o={audioTrack:e.step_audio,step:e});var e,n=o.audioTrack;n&&-1===n.indexOf("?st=")&&(n+=getCdnSign()),GmCXt.checkAssetUrl(n,n,function(e){e&&(n=e);var e=o.step,t=(GmCXt.audioObject&&GmCXt.audioObject.pause(),GmCXt.audioObject=new Audio(n),"mgPlayerJSTest2_action:start_step_completion_timeout"),a={step:e},e=(GmCXt.audioObject.onended=function(){formatAndSendToParentWindow(t,a)},GmCXt.audioObject.play());void 0!==e&&e.then(function(){}).catch(function(e){formatAndSendToParentWindow(t,a),setAudioModeOff()})})},GmCXt.stopAudio=function(){GmCXt.audioObject&&GmCXt.audioObject.pause()},document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-on").forEach(e=>{e.addEventListener("click",function(){userPrefAudio=!0,GmCXt.stopAudio(),formatAndSendToParentWindow("mgPlayerJSTest2_action:stop_audio",{}),setAudioModeOff()})}),document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-off").forEach(e=>{e.addEventListener("click",function(){var e;userPrefAudio=!0,GmCXt.playerI&&(e=getStepFromPlayerI(GmCXt.playerI.currentStepId),message={audioTrack:e.step_audio,step:e},GmCXt.isPageReloaded=!1,GmCXt.playStepAudio(message))})}),document.addEventListener("DOMContentLoaded",function(){formatAndSendToParentWindow("mgPlayerJSTest2_action:set_style_audio_icon",{})});