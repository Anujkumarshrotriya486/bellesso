void 0===GmCXt&&(GmCXt={});var GmCXt,stepAudio={},userPrefAudio=!1;function setAudioModeOn(){mg$(".mgPlayerJSProd_play-step-audio-on").show(),mg$(".mgPlayerJSProd_play-step-audio-off").hide(),mg$(".mgPlayerJSProd_play-step-audio").addClass("playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSProd_action:set_audio_storage",{stepAudioRunningStatus:!0})}function setAudioModeOff(){mg$(".mgPlayerJSProd_play-step-audio-on").hide(),mg$(".mgPlayerJSProd_play-step-audio-off").show(),mg$(".mgPlayerJSProd_play-step-audio").removeClass("playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSProd_action:set_audio_storage",{stepAudioRunningStatus:!1})}function pauseAudio(){GmCXt.audioObject&&GmCXt.audioObject.pause()}function formatAndSendToParentWindow(t,e){var a={};a.action=t,a.data=e||{},!GmCXt.playerI&&null!==GmCXt.playerI||(a.data.playerInstance=GmCXt.playerI),GmCXt.sendToParentWindow(a)}mg$(".mgPlayerJSProd_audio-iframe-icons")&&0<mg$(".mgPlayerJSProd_audio-iframe-icons").length&&GmCXt.startMsgChannel("Guide:audioIframe"),window.addEventListener("error",function(t){t&&t.target&&GmCXt.onImageLoadError(mg$(t.target))},!0),void 0===GmCXt.requestHandler&&(GmCXt.requestHandler={}),GmCXt.requestHandler.playAudioTrack=function(t){GmCXt.FT.audio&&(t.data.playerInstance&&(GmCXt.playerI=t.data.playerInstance),GmCXt.playStepAudio(t.data))},GmCXt.requestHandler.stopAudioTrack=function(t){GmCXt.stopAudio()},window.addEventListener("message",function(t){var e=(GmCXt=GmCXt||t.target.GmCXt).parseMsg(t);if(e&&e.action&&0===e.action.indexOf("mgPlayerJSProd_action:"))switch((e=GmCXt.convertMgdata(e)).data&&(e.data.config&&(GmCXt.conf=e.data.config),e.data.user&&!GmCXt.isEmpty(e.data.user)&&GmCXt.updateGlobalUser(e.data.user),stepAudio.tour=e.data.tour||{},stepAudio.type=e.data.type||"",stepAudio.stepIndex=e.data.stepIndex||-1,GmCXt.syncPlayerInst(e.action))&&e.data.playerInstance&&(GmCXt.playerI=e.data.playerInstance),e.action){case"mgPlayerJSProd_action:set_audio_mode_on":setAudioModeOn();break;case"mgPlayerJSProd_action:set_audio_mode_off":setAudioModeOff();break;case"mgPlayerJSProd_action:stop_audio":GmCXt.requestHandler.stopAudioTrack();break;case"mgPlayerJSProd_action:set_style_audio_icon_response":mg$("html:first").append(e.data.data),mg$(".mgPlayerJSProd_audio-iframe-icons").removeAttr("style"),formatAndSendToParentWindow("mgPlayerJSProd_action:hide_pop_audio_ctrl",{})}},!1),GmCXt.checkAssetUrl=function(t,e,a){t===e?a(t):GmCXt.checkFileExist(t).then(function(){a(t)}).catch(function(t){a(e)})},GmCXt.playStepAudio=function(o){GmCXt.isPageReloaded=!1,setAudioModeOn(),o&&o.data||GmCXt.playerI&&(t=GmCXt.getCurrentStep(GmCXt.playerI.currentStepId),o={audioTrack:t.step_audio,step:t});var t,d=o.audioTrack;d&&-1===d.indexOf("?st=")&&(d+=GmCXt.getCdnSign()),GmCXt.checkAssetUrl(d,d,function(t){t&&(d=t);var t=o.step,e=(GmCXt.audioObject&&GmCXt.audioObject.pause(),GmCXt.audioObject=new Audio(d),"mgPlayerJSProd_action:start_step_completion_timeout"),a={step:t},t=(GmCXt.audioObject.onended=function(){formatAndSendToParentWindow(e,a)},GmCXt.audioObject.play());void 0!==t&&t.then(function(){}).catch(function(t){formatAndSendToParentWindow(e,a),setAudioModeOff()})})},GmCXt.stopAudio=function(){GmCXt.audioObject&&GmCXt.audioObject.pause()},mg$(".mgPlayerJSProd_play-step-audio-on").off("click").on("click",function(){userPrefAudio=!0,GmCXt.stopAudio(),formatAndSendToParentWindow("mgPlayerJSProd_action:stop_audio",{}),setAudioModeOff()}),mg$(".mgPlayerJSProd_play-step-audio-off").off("click").on("click",function(){var t;userPrefAudio=!0,setAudioModeOn(),GmCXt.playerI&&(t=GmCXt.getCurrentStep(GmCXt.playerI.currentStepId),message={audioTrack:t.step_audio,step:t},GmCXt.isPageReloaded=!1,GmCXt.playStepAudio(message))}),mg$(document).ready(function(){formatAndSendToParentWindow("mgPlayerJSProd_action:set_style_audio_icon",{})});