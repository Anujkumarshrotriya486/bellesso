void 0===GmCXt&&(GmCXt={});var GmCXt,stepAudio={},userPrefAudio=!1;function setAudioModeOn(){mg$(".mgPlayerJSPreview_play-step-audio-on").show(),mg$(".mgPlayerJSPreview_play-step-audio-off").hide(),mg$(".mgPlayerJSPreview_play-step-audio").addClass("playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSPreview_action:set_audio_storage",{stepAudioRunningStatus:!0})}function setAudioModeOff(){mg$(".mgPlayerJSPreview_play-step-audio-on").hide(),mg$(".mgPlayerJSPreview_play-step-audio-off").show(),mg$(".mgPlayerJSPreview_play-step-audio").removeClass("playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSPreview_action:set_audio_storage",{stepAudioRunningStatus:!1})}function pauseAudio(){GmCXt.audioObject&&GmCXt.audioObject.pause()}function formatAndSendToParentWindow(e,t){var a={};a.action=e,a.data=t||{},!GmCXt.playerI&&null!==GmCXt.playerI||(a.data.playerInstance=GmCXt.playerI),GmCXt.sendToParentWindow(a)}mg$(".mgPlayerJSPreview_audio-iframe-icons")&&0<mg$(".mgPlayerJSPreview_audio-iframe-icons").length&&GmCXt.startMsgChannel("Guide:audioIframe"),window.addEventListener("error",function(e){e&&e.target&&GmCXt.onImageLoadError(mg$(e.target))},!0),void 0===GmCXt.requestHandler&&(GmCXt.requestHandler={}),GmCXt.requestHandler.playAudioTrack=function(e){GmCXt.FT.audio&&(e.data.playerInstance&&(GmCXt.playerI=e.data.playerInstance),GmCXt.playStepAudio(e.data))},GmCXt.requestHandler.stopAudioTrack=function(e){GmCXt.stopAudio()},window.addEventListener("message",function(e){var t=(GmCXt=GmCXt||e.target.GmCXt).parseMsg(e);if(t&&t.action&&0===t.action.indexOf("mgPlayerJSPreview_action:"))switch((t=GmCXt.convertMgdata(t)).data&&(t.data.config&&(GmCXt.conf=t.data.config),t.data.user&&!GmCXt.isEmpty(t.data.user)&&GmCXt.updateGlobalUser(t.data.user),stepAudio.tour=t.data.tour||{},stepAudio.type=t.data.type||"",stepAudio.stepIndex=t.data.stepIndex||-1,GmCXt.syncPlayerInst(t.action))&&t.data.playerInstance&&(GmCXt.playerI=t.data.playerInstance),t.action){case"mgPlayerJSPreview_action:set_audio_mode_on":setAudioModeOn();break;case"mgPlayerJSPreview_action:set_audio_mode_off":setAudioModeOff();break;case"mgPlayerJSPreview_action:stop_audio":GmCXt.requestHandler.stopAudioTrack();break;case"mgPlayerJSPreview_action:set_style_audio_icon_response":mg$("html:first").append(t.data.data),mg$(".mgPlayerJSPreview_audio-iframe-icons").removeAttr("style"),formatAndSendToParentWindow("mgPlayerJSPreview_action:hide_pop_audio_ctrl",{})}},!1),GmCXt.checkAssetUrl=function(e,t,a){e===t?a(e):GmCXt.checkFileExist(e).then(function(){a(e)}).catch(function(e){a(t)})},GmCXt.playStepAudio=function(o){GmCXt.isPageReloaded=!1,setAudioModeOn(),o&&o.data||GmCXt.playerI&&(e=GmCXt.getCurrentStep(GmCXt.playerI.currentStepId),o={audioTrack:e.step_audio,step:e});var e,i=o.audioTrack;i&&-1===i.indexOf("?st=")&&(i+=GmCXt.getCdnSign()),GmCXt.checkAssetUrl(i,i,function(e){e&&(i=e);var e=o.step,t=(GmCXt.audioObject&&GmCXt.audioObject.pause(),GmCXt.audioObject=new Audio(i),"mgPlayerJSPreview_action:start_step_completion_timeout"),a={step:e},e=(GmCXt.audioObject.onended=function(){formatAndSendToParentWindow(t,a)},GmCXt.audioObject.play());void 0!==e&&e.then(function(){}).catch(function(e){formatAndSendToParentWindow(t,a),setAudioModeOff()})})},GmCXt.stopAudio=function(){GmCXt.audioObject&&GmCXt.audioObject.pause()},mg$(".mgPlayerJSPreview_play-step-audio-on").off("click").on("click",function(){userPrefAudio=!0,GmCXt.stopAudio(),formatAndSendToParentWindow("mgPlayerJSPreview_action:stop_audio",{}),setAudioModeOff()}),mg$(".mgPlayerJSPreview_play-step-audio-off").off("click").on("click",function(){var e;userPrefAudio=!0,setAudioModeOn(),GmCXt.playerI&&(e=GmCXt.getCurrentStep(GmCXt.playerI.currentStepId),message={audioTrack:e.step_audio,step:e},GmCXt.isPageReloaded=!1,GmCXt.playStepAudio(message))}),mg$(document).ready(function(){formatAndSendToParentWindow("mgPlayerJSPreview_action:set_style_audio_icon",{})});