void 0===GmPXtTest&&(GmPXtTest={});var GmPXtTest,stepAudio={},userPrefAudio=!1;function setAudioModeOn(){mg$(".mgPlayerExtChromeTest_play-step-audio-on").show(),mg$(".mgPlayerExtChromeTest_play-step-audio-off").hide(),mg$(".mgPlayerExtChromeTest_play-step-audio").addClass("playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerExtChromeTest_action:set_audio_storage",{stepAudioRunningStatus:!0})}function setAudioModeOff(){mg$(".mgPlayerExtChromeTest_play-step-audio-on").hide(),mg$(".mgPlayerExtChromeTest_play-step-audio-off").show(),mg$(".mgPlayerExtChromeTest_play-step-audio").removeClass("playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerExtChromeTest_action:set_audio_storage",{stepAudioRunningStatus:!1})}function pauseAudio(){GmPXtTest.audioObject&&GmPXtTest.audioObject.pause()}function formatAndSendToParentWindow(t,e){var a={};a.action=t,a.data=e||{},!GmPXtTest.playerI&&null!==GmPXtTest.playerI||(a.data.playerInstance=GmPXtTest.playerI),GmPXtTest.sendToParentWindow(a)}window.addEventListener("error",function(t){t&&t.target&&GmPXtTest.onImageLoadError(mg$(t.target))},!0),void 0===GmPXtTest.requestHandler&&(GmPXtTest.requestHandler={}),GmPXtTest.requestHandler.playAudioTrack=function(t){GmPXtTest.FT.audio&&(t.data.playerInstance&&(GmPXtTest.playerI=t.data.playerInstance),GmPXtTest.playStepAudio(t.data))},GmPXtTest.requestHandler.stopAudioTrack=function(t){GmPXtTest.stopAudio()},window.addEventListener("message",function(t){var e=(GmPXtTest=GmPXtTest||t.target.GmPXtTest).parseMsg(t);if(e&&e.action&&0===e.action.indexOf("mgPlayerExtChromeTest_action:"))switch((e=GmPXtTest.convertMgdata(e)).data&&(e.data.config&&(GmPXtTest.conf=e.data.config),e.data.user&&!GmPXtTest.isEmpty(e.data.user)&&GmPXtTest.updateGlobalUser(e.data.user),stepAudio.tour=e.data.tour||{},stepAudio.type=e.data.type||"",stepAudio.stepIndex=e.data.stepIndex||-1,GmPXtTest.syncPlayerInst(e.action))&&e.data.playerInstance&&(GmPXtTest.playerI=e.data.playerInstance),e.action){case"mgPlayerExtChromeTest_action:set_audio_mode_on":setAudioModeOn();break;case"mgPlayerExtChromeTest_action:set_audio_mode_off":setAudioModeOff();break;case"mgPlayerExtChromeTest_action:stop_audio":GmPXtTest.requestHandler.stopAudioTrack();break;case"mgPlayerExtChromeTest_action:set_style_audio_icon_response":mg$("html:first").append(e.data.data),mg$(".mgPlayerExtChromeTest_audio-iframe-icons").removeAttr("style"),formatAndSendToParentWindow("mgPlayerExtChromeTest_action:hide_pop_audio_ctrl",{})}},!1),GmPXtTest.checkAssetUrl=function(t,e,a){t===e?a(t):GmPXtTest.checkFileExist(t).then(function(){a(t)}).catch(function(t){a(e)})},GmPXtTest.playStepAudio=function(o){GmPXtTest.isPageReloaded=!1,setAudioModeOn(),o&&o.data||GmPXtTest.playerI&&(t=GmPXtTest.getCurrentStep(GmPXtTest.playerI.currentStepId),o={audioTrack:t.step_audio,step:t});var t,s=o.audioTrack;s&&-1===s.indexOf("?st=")&&(s+=GmPXtTest.getCdnSign()),GmPXtTest.checkAssetUrl(s,s,function(t){t&&(s=t);var t=o.step,e=(GmPXtTest.audioObject&&GmPXtTest.audioObject.pause(),GmPXtTest.audioObject=new Audio(s),"mgPlayerExtChromeTest_action:start_step_completion_timeout"),a={step:t},t=(GmPXtTest.audioObject.onended=function(){formatAndSendToParentWindow(e,a)},GmPXtTest.audioObject.play());void 0!==t&&t.then(function(){}).catch(function(t){formatAndSendToParentWindow(e,a),setAudioModeOff()})})},GmPXtTest.stopAudio=function(){GmPXtTest.audioObject&&GmPXtTest.audioObject.pause()},mg$(".mgPlayerExtChromeTest_play-step-audio-on").off("click").on("click",function(){userPrefAudio=!0,GmPXtTest.stopAudio(),formatAndSendToParentWindow("mgPlayerExtChromeTest_action:stop_audio",{}),setAudioModeOff()}),mg$(".mgPlayerExtChromeTest_play-step-audio-off").off("click").on("click",function(){var t;userPrefAudio=!0,setAudioModeOn(),GmPXtTest.playerI&&(t=GmPXtTest.getCurrentStep(GmPXtTest.playerI.currentStepId),message={audioTrack:t.step_audio,step:t},GmPXtTest.isPageReloaded=!1,GmPXtTest.playStepAudio(message))}),mg$(document).ready(function(){formatAndSendToParentWindow("mgPlayerExtChromeTest_action:set_style_audio_icon",{})});