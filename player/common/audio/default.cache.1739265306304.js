var GmCXt,stepAudio={},userPrefAudio=!1;function modifyElements(e,t,a){e.forEach(e=>{switch(t){case"show":e.style.display="block";break;case"hide":e.style.display="none";break;case"addClass":e.classList.add(a);break;case"removeClass":e.classList.remove(a)}})}function setAudioModeOn(){document.getElementsByClassName("mgPlayerJSTest2_play-step-audio-on")&&document.getElementsByClassName("mgPlayerJSTest2_play-step-audio-on").length?(modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-on"),"show"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-off"),"hide"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio"),"addClass","playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSTest2_action:set_audio_storage",{stepAudioRunningStatus:!0})):formatAndSendToParentWindow("mgPlayerJSTest2_action:set_audio_mode_on",{})}function setAudioModeOff(){document.getElementsByClassName("mgPlayerJSTest2_play-step-audio-off")&&document.getElementsByClassName("mgPlayerJSTest2_play-step-audio-off").length?(modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-on"),"hide"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-off"),"show"),modifyElements(document.querySelectorAll(".mgPlayerJSTest2_play-step-audio"),"removeClass","playing-audio"),userPrefAudio&&formatAndSendToParentWindow("mgPlayerJSTest2_action:set_audio_storage",{stepAudioRunningStatus:!1})):formatAndSendToParentWindow("mgPlayerJSTest2_action:set_audio_mode_off",{})}function parseJSON(e){try{return"object"==typeof e?e:""===e||"AS"===e||"na"===e||"[object Object]"===e||void 0===e||"undefined"===e?{}:JSON.parse(e)}catch(e){return{}}}function parseMsg(e){return parseJSON(e.data)}function getCdnSign(){var e="";return e=GmCXt.user?GmCXt.user.cdn_signature:e}function convertMgdata(e){return e.action&&-1!==e.action.indexOf("init_sfdc_env")||e.data&&e.data.config&&e.data.config.appConfig&&"westpac"===e.data.config.appConfig.customer&&e.action&&-1!==e.action.indexOf("MyGuideReporting")||(e.data=e.mgdata),e}function syncPlayerInst(e){return"mgPlayerJSTest2_action:started;task:select_existing_dom_element"===e||"mgPlayerJSTest2_action:started;task:select_existing_dom_element:target_frame_only"===e||"mgPlayerJSTest2_action:started;task:select_dom_element_tooltips"===e||"mgPlayerJSTest2_action:task:init_new_iframe"===e||"mgPlayerJSTest2_action:update_player_instance"===e||"mgPlayerJSTest2_action:play_slideshow"===e||"mgPlayerJSTest2_action:play_video_step"===e||"mgPlayerJSTest2_action:play_image_step"===e||"mgPlayerJSTest2_action:click; on:mgPlayerJSTest2_slideshow-close"===e||"mgPlayerJSTest2_action:mark_auto_tour_donotshow"===e||"mgPlayerJSTest2_action:update_player_instance_app"===e||"mgPlayerJSTest2_action:set_audio_mode_off"===e||"mgPlayerJSTest2_action:set_audio_mode_on"===e||"mgPlayerJSTest2_action:close_guide"===e||"mgPlayerJSTest2_action:set_style_audio_icon_response"===e}function pauseAudio(){GmCXt.audioObject&&GmCXt.audioObject.pause()}function getStepFromPlayerI(e){for(var t=!1,a=GmCXt.playerI.tour.steps,o=0;o<a.length;o++)if(parseInt(a[o].step_id)===parseInt(e)){t=a[o];break}return t.step_description||(t.step_description=" "),t.image_url=t.image_url+getCdnSign(),t.screen_url=t.screen_url+getCdnSign(),t}function formatAndSendToParentWindow(e,t){var a={};a.action=e,a.data=t||{},!GmCXt.playerI&&null!==GmCXt.playerI||(a.data.playerInstance=GmCXt.playerI),a.data&&"object"==typeof a.data&&(GmCXt.isSidePanelApp&&(a.data.fromSidePanel=GmCXt.isSidePanelApp),"mgPlayerJSTest2_action:update_custom_labels"!==a.action&&"mgPlayerJSTest2_action:set_lang_content_script"!==a.action&&"mgPlayerJSTest2_action:update:player_mode"!==a.action&&"mgPlayerJSTest2_action:save_user_info"!==a.action&&"mgPlayerJSTest2_action:payload_event_call"!==a.action&&(a.data.user=GmCXt.user),"mgPlayerJSTest2_action:payload_event_call"===a.action)&&delete a.data.fromSidePanel,a.data&&a.data.config&&a.data.config.appConfig&&"westpac"===a.data.config.appConfig.customer&&-1!==a.action.indexOf("MyGuideReporting")?GmCXt.msgChannel.port1.postMessage(a):(a.data&&(a.mgdata=a.data,delete a.data),GmCXt.msgChannel.port1.postMessage(JSON.stringify(a)))}function audioOnBtnClick(){userPrefAudio=!0,GmCXt.stopAudio(),formatAndSendToParentWindow("mgPlayerJSTest2_action:stop_audio",{}),setAudioModeOff()}function audioOffBtnClick(){var e;userPrefAudio=!0,GmCXt.playerI&&(e=getStepFromPlayerI(GmCXt.playerI.currentStepId),message={audioTrack:e.step_audio,step:e},GmCXt.isPageReloaded=!1,GmCXt.playStepAudio(message))}(GmCXt=void 0===GmCXt?{}:GmCXt).msgChannel=new MessageChannel,GmCXt.startMsgChannel=function(e){window.top.postMessage(e,"*",[GmCXt.msgChannel.port2])},0<document.querySelectorAll(".mgPlayerJSTest2_audio-iframe-icons").length&&GmCXt.startMsgChannel("Guide:audioIframe"),void 0===GmCXt.requestHandler&&(GmCXt.requestHandler={}),GmCXt.requestHandler.playAudioTrack=function(e){e.data.playerInstance&&(GmCXt.playerI=e.data.playerInstance),GmCXt.playStepAudio(e.data)},GmCXt.requestHandler.stopAudioTrack=function(e){GmCXt.stopAudio()},window.addEventListener("message",function(e){GmCXt=GmCXt||e.target.GmCXt;var t=parseMsg(e);if(t&&t.action&&0===t.action.indexOf("mgPlayerJSTest2_action:"))switch((t=convertMgdata(t)).data&&(t.data.config&&(GmCXt.conf=t.data.config),t.data.user&&Object.keys(t.data.user).length&&(GmCXt.user=t.data.user,formatAndSendToParentWindow("mgPlayerJSTest2_action:save_user_info",t.data.user)),syncPlayerInst(t.action))&&t.data.playerInstance&&(GmCXt.playerI=t.data.playerInstance),t.action){case"mgPlayerJSTest2_action:set_audio_mode_on":setAudioModeOn();break;case"mgPlayerJSTest2_action:set_audio_mode_off":setAudioModeOff();break;case"mgPlayerJSTest2_action:stop_audio":GmCXt.requestHandler.stopAudioTrack();break;case"mgPlayerJSTest2_action:set_style_audio_icon_response":document.documentElement.insertAdjacentHTML("beforeend",t.data.data),document.querySelectorAll(".mgPlayerJSTest2_audio-iframe-icons").forEach(e=>{e.removeAttribute("style")}),formatAndSendToParentWindow("mgPlayerJSTest2_action:hide_pop_audio_ctrl",{})}},!1),GmCXt.checkAssetUrl=function(e,t,a){e===t?a(e):GmCXt.checkFileExist(e).then(function(){a(e)}).catch(function(e){a(t)})},GmCXt.playStepAudio=function(o){GmCXt.isPageReloaded=!1,setAudioModeOn(),o&&o.data||GmCXt.playerI&&(e=getStepFromPlayerI(GmCXt.playerI.currentStepId),o={audioTrack:e.step_audio,step:e});var e,n=o.audioTrack;n&&-1===n.indexOf("?st=")&&(n+=getCdnSign()),GmCXt.checkAssetUrl(n,n,function(e){e&&(n=e);var e=o.step,t=(GmCXt.audioObject&&GmCXt.audioObject.pause(),GmCXt.audioObject=new Audio(n),"mgPlayerJSTest2_action:start_step_completion_timeout"),a={step:e},e=(GmCXt.audioObject.onended=function(){formatAndSendToParentWindow(t,a)},GmCXt.audioObject.play());void 0!==e&&e.then(function(){}).catch(function(e){console.log("Audio Track Fail",e),formatAndSendToParentWindow(t,a),setAudioModeOff()})})},GmCXt.stopAudio=function(){GmCXt.audioObject&&GmCXt.audioObject.pause()},document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-on").forEach(e=>{e.removeEventListener("click",audioOnBtnClick),e.addEventListener("click",function(){audioOnBtnClick()})}),document.querySelectorAll(".mgPlayerJSTest2_play-step-audio-off").forEach(e=>{e.removeEventListener("click",audioOffBtnClick),e.addEventListener("click",function(){audioOffBtnClick()})}),document.addEventListener("DOMContentLoaded",function(){formatAndSendToParentWindow("mgPlayerJSTest2_action:set_style_audio_icon",{})});